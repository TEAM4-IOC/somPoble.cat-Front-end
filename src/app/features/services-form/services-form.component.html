<div class="serveis-form-container">
    <div class="add-service-container">
      @if (servicio$ | async; as servicios) {
        @if (!isEditMode) {
          <!-- MODO CREACIÓN -->
          <h1>{{ empresaNombre }}</h1>
          <h2>{{ 'add-services-form.nameForm' | translate }}</h2>
          <form (ngSubmit)="onSubmit()" #serviceForm="ngForm">
            <!-- CAMPOS DE CREACIÓN -->
            <div class="input-group">
              <label for="nombreServicio" class="form-label">{{ 'add-services-form.serviceName' | translate }}:</label>
              <div class="input-control">
                <input
                  type="text"
                  id="nombreServicio"
                  [(ngModel)]="nombre"
                  name="nombreServicio"
                  placeholder="{{ 'add-services-form.serviceName_placeholder' | translate }}"
                  required
                  pattern="^(?=(.*[A-Za-z]){2,}).*$"
                  #nombreModel="ngModel"
                />
              </div>
              @if (nombreModel.invalid && (nombreModel.touched || nombreModel.dirty)) {
                <div class="error">{{ 'add-services-form.serviceName_error' | translate }}</div>
              }
            </div>
            <div class="input-group">
              <label for="descripcionServicio" class="form-label">{{ 'add-services-form.serviceDescription' | translate }}:</label>
              <div class="input-control">
                <textarea
                  id="descripcionServicio"
                  [(ngModel)]="descripcion"
                  name="descripcionServicio"
                  placeholder="{{ 'add-services-form.serviceDescription_placeholder' | translate }}"
                  required
                  rows="5"
                  pattern="^[A-Za-zÀ-ÿ0-9 .,!?()'\n\r-]{2,200}$"
                  #descripcionModel="ngModel"
                ></textarea>
              </div>
              @if (descripcionModel.invalid && (descripcionModel.touched || descripcionModel.dirty)) {
                <div class="error">{{ 'add-services-form.serviceDescription_eror' | translate }}</div>
              }
            </div>
            <div class="input-group">
              <label for="duracionServicio" class="form-label">{{ 'add-services-form.serviceDuration' | translate }}:</label>
              <div class="input-control">
                <input
                  type="text"
                  id="duracionServicio"
                  [(ngModel)]="duracion"
                  name="duracionServicio"
                  placeholder="{{ 'add-services-form.serviceDuration_placeholder' | translate }}"
                  required
                  pattern="^[0-9]+$"
                  #duracionModel="ngModel"
                />
              </div>
              @if (duracionModel.invalid && (duracionModel.touched || duracionModel.dirty)) {
                <div class="error">{{ 'add-services-form.serviceDuration_error' | translate }}</div>
              }
            </div>
            <div class="input-group">
              <label for="precioServicio" class="form-label">{{ 'add-services-form.servicePrice' | translate }}:</label>
              <div class="input-control">
                <input
                  type="text"
                  id="precioServicio"
                  [(ngModel)]="precio"
                  name="precioServicio"
                  placeholder="{{ 'add-services-form.servicePrice_placeholder' | translate }}"
                  required
                  (input)="onInputChange($event)"
                  (keydown)="validatePrecio($event)"
                  #precioModel="ngModel"
                />
              </div>
              @if (precioModel.invalid && (precioModel.touched || precioModel.dirty)) {
                <div class="error">{{ 'add-services-form.servicePrice_error' | translate }}</div>
              }
            </div>
            <div class="input-group">
              <label for="horario" class="form-label">{{ 'add-services-form.serviceAvailability' | translate }}:</label>
              <div class="input-control">
                <input
                  type="text"
                  id="horario"
                  [(ngModel)]="horario"
                  name="horario"
                  placeholder="{{ 'add-services-form.serviceAvailability_placeholder' | translate }} e: 09:00-18:00"
                  required
                  pattern="^([01]\d|2[0-3]):([0-5]\d)-([01]\d|2[0-3]):([0-5]\d)$"
                  #horarioModel="ngModel"
                  (input)="validateHorario($event)"
                />
              </div>
              @if (horarioModel.invalid && (horarioModel.touched || horarioModel.dirty)) {
                <div class="error">{{ 'add-services-form.serviceAvailability_error' | translate }}</div>
              }
            </div>
            <div class="input-group">
              <label for="limiteReserva" class="form-label">{{ 'add-services-form.serviceReservations' | translate }}:</label>
              <div class="input-control">
                <input
                  type="text"
                  id="limite"
                  [(ngModel)]="limiteReservas"
                  name="limiteReserva"
                  placeholder="{{ 'add-services-form.serviceReservations_placeholder' | translate }}"
                  required
                  pattern="^[0-9]+$"
                  #limiteReservasModel="ngModel"
                />
              </div>
              @if (limiteReservasModel.invalid && (limiteReservasModel.touched || limiteReservasModel.dirty)) {
                <div class="error">{{ 'add-services-form.serviceReservations_error' | translate }}</div>
              }
            </div>
            <button type="submit" class="auth-btn">
              {{ 'add-services-form.serviceSubmit' | translate }}
            </button>
            @if (formError) {
              <div class="error">{{ formError | translate }}</div>
            }
          </form>
        } @else {
          <!-- MODO EDICIÓN -->
          <h1>{{ empresaNombre }}</h1>
          <h2>{{ 'add-services-form.nameForm_edit' | translate }}</h2>
          <div class="read-only-data">
            <!-- Nombre -->
            <div class="data-field">
              <label>{{ 'add-services-form.serviceName' | translate }}:</label>
              @if (!editingField('nombre')) {
                <span>{{ nombre }}</span>
                <button class="icon-btn" (click)="startEditing('nombre', nombre)">
                  <i class="fas fa-edit"></i>
                </button>
              } @else {
                <input
                  type="text"
                  [(ngModel)]="tempValue"
                  required
                  pattern="^(?=(.*[A-Za-z]){2,}).*$"
                  #nombreEdit="ngModel"
                />
                <button class="icon-btn" (click)="confirmEditing('nombre')">
                  <i class="fas fa-check"></i>
                </button>
                <button class="icon-btn" (click)="cancelEditing()">
                  <i class="fas fa-times"></i>
                </button>
                @if (nombreEdit.invalid && (nombreEdit.touched || nombreEdit.dirty)) {
                  <div class="error">{{ 'add-services-form.serviceName_error' | translate }}</div>
                }
              }
            </div>
            <!-- Descripción -->
            <div class="data-field">
              <label>{{ 'add-services-form.serviceDescription' | translate }}:</label>
              @if (!editingField('descripcion')) {
                <span>{{ descripcion }}</span>
                <button class="icon-btn" (click)="startEditing('descripcion', descripcion)">
                  <i class="fas fa-edit"></i>
                </button>
              } @else {
                <textarea
                  [(ngModel)]="tempValue"
                  required
                  rows="5"
                  pattern="^[A-Za-z0-9 ]{2,200}$"
                  #descripcionEdit="ngModel"
                ></textarea>
                <button class="icon-btn" (click)="confirmEditing('descripcion')">
                  <i class="fas fa-check"></i>
                </button>
                <button class="icon-btn" (click)="cancelEditing()">
                  <i class="fas fa-times"></i>
                </button>
                @if (descripcionEdit.invalid && (descripcionEdit.touched || descripcionEdit.dirty)) {
                  <div class="error">{{ 'add-services-form.serviceDescription_eror' | translate }}</div>
                }
              }
            </div>
            <!-- Duración -->
            <div class="data-field">
              <label>{{ 'add-services-form.serviceDuration' | translate }}:</label>
              @if (!editingField('duracion')) {
                <span>{{ duracion }}</span>
                <button class="icon-btn" (click)="startEditing('duracion', duracion)">
                  <i class="fas fa-edit"></i>
                </button>
              } @else {
                <input
                  type="text"
                  [(ngModel)]="tempValue"
                  required
                  pattern="^[0-9]+$"
                  #duracionEdit="ngModel"
                />
                <button class="icon-btn" (click)="confirmEditing('duracion')">
                  <i class="fas fa-check"></i>
                </button>
                <button class="icon-btn" (click)="cancelEditing()">
                  <i class="fas fa-times"></i>
                </button>
                @if (duracionEdit.invalid && (duracionEdit.touched || duracionEdit.dirty)) {
                  <div class="error">{{ 'add-services-form.serviceDuration_error' | translate }}</div>
                }
              }
            </div>
            <!-- Precio -->
            <div class="data-field">
              <label>{{ 'add-services-form.servicePrice' | translate }}:</label>
              @if (!editingField('precio')) {
                <span>{{ precio }}</span>
                <button class="icon-btn" (click)="startEditing('precio', precio)">
                  <i class="fas fa-edit"></i>
                </button>
              } @else {
                <input
                  type="text"
                  [(ngModel)]="tempValue"
                  required
                  (input)="onInputChange($event)"
                  (keydown)="validatePrecio($event)"
                  #precioEdit="ngModel"
                />
                <button class="icon-btn" (click)="confirmEditing('precio')">
                  <i class="fas fa-check"></i>
                </button>
                <button class="icon-btn" (click)="cancelEditing()">
                  <i class="fas fa-times"></i>
                </button>
                @if (precioEdit.invalid && (precioEdit.touched || precioEdit.dirty)) {
                  <div class="error">{{ 'add-services-form.servicePrice_error' | translate }}</div>
                }
              }
            </div>
            <!-- Horario -->
            <div class="data-field">
              <label>{{ 'add-services-form.serviceAvailability' | translate }}:</label>
              @if (!editingField('horario')) {
                <span>{{ horario }}</span>
                <button class="icon-btn" (click)="startEditing('horario', horario)">
                  <i class="fas fa-edit"></i>
                </button>
              } @else {
                <input
                  type="text"
                  [(ngModel)]="tempValue"
                  required
                  pattern="^([01]\d|2[0-3]):([0-5]\d)-([01]\d|2[0-3]):([0-5]\d)$"
                  #horarioEdit="ngModel"
                />
                <button class="icon-btn" (click)="confirmEditing('horario')">
                  <i class="fas fa-check"></i>
                </button>
                <button class="icon-btn" (click)="cancelEditing()">
                  <i class="fas fa-times"></i>
                </button>
                @if (horarioEdit.invalid && (horarioEdit.touched || horarioEdit.dirty)) {
                  <div class="error">{{ 'add-services-form.serviceAvailability_error' | translate }}</div>
                }
              }
            </div>
            <!-- Límite de reservas -->
            <div class="data-field">
              <label>{{ 'add-services-form.serviceReservations' | translate }}:</label>
              @if (!editingField('limiteReservas')) {
                <span>{{ limiteReservas }}</span>
                <button class="icon-btn" (click)="startEditing('limiteReservas', limiteReservas!.toString())">
                  <i class="fas fa-edit"></i>
                </button>
              } @else {
                <input
                  type="text"
                  [(ngModel)]="tempValue"
                  required
                  pattern="^[0-9]+$"
                  #limiteReservasEdit="ngModel"
                />
                <button class="icon-btn" (click)="confirmEditing('limiteReservas')">
                  <i class="fas fa-check"></i>
                </button>
                <button class="icon-btn" (click)="cancelEditing()">
                  <i class="fas fa-times"></i>
                </button>
                @if (limiteReservasEdit.invalid && (limiteReservasEdit.touched || limiteReservasEdit.dirty)) {
                  <div class="error">{{ 'add-services-form.serviceReservations_error' | translate }}</div>
                }
              }
            </div>
            <button class="auth-btn" (click)="onSubmit()">
              {{ 'add-services-form.serviceSubmit_edit' | translate }}
            </button>
            <button *ngIf="idServicio !== null" class="delete-btn" (click)="deleteServicio(idServicio!)">
              <i class="fas fa-trash"></i> {{ 'add-services-form.serviceDelete' | translate }}
            </button>
          </div>
        }
      } @else {
        <p>Cargando servicios...</p>
      }
    </div>
  </div>