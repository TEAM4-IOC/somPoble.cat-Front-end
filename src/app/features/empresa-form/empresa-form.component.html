<div class="component-wrapper">
  <div class="auth-container">
    <h1>SomPoble</h1>

    @if (!showForm) {
      <h2>Selecciona el teu rol</h2>
      <div class="role-selection">
        <select #roleSelect (change)="selectRole(+roleSelect.value)">
          <option value="" disabled selected>Escull una opció</option>
          <option value="1">Empresari</option>
          <option value="2">Autònom</option>
        </select>
      </div>
    } @else {
      @if (selectedRole === 1) {
        <h2>Formulari Empresari</h2>
      } @else if (selectedRole === 2) {
        <h2>Formulari Autònom</h2>
      } @else {
        <h2>Formulari</h2>
      }
      <form (ngSubmit)="onSubmit()" #empresaForm="ngForm">
        <div class="input-group">
          <label for="identificadorFiscal" class="form-label">
            {{ selectedRole === 1 ? 'CIF' : 'DNI de l\'autònom' }}
          </label>
          <div class="input-control">
            <input
              type="text"
              id="identificadorFiscal"
              [(ngModel)]="identificadorFiscal"
              name="identificadorFiscal"
              [placeholder]="selectedRole === 1 ? 'Introdueix el CIF' : 'Introdueix el DNI'"
              required
              pattern="[0-9]{8,9}[A-Za-z]?"
              #identificadorFiscalModel="ngModel"
            />
          </div>
          @if (identificadorFiscalModel.invalid && (identificadorFiscalModel.touched || identificadorFiscalModel.dirty)) {
            <div class="error">
              El camp és obligatori i ha de seguir el format correcte.
            </div>
          }
        </div>

        @if (selectedRole === 1) {
          <div class="input-group">
            <label for="nombre" class="form-label">Nom</label>
            <div class="input-control">
              <input
                type="text"
                id="nombre"
                [(ngModel)]="nombre"
                name="nombre"
                placeholder="Introdueix el nom"
                required
                minlength="2"
                #nombreModel="ngModel"
              />
            </div>
            @if (nombreModel.invalid && (nombreModel.touched || nombreModel.dirty)) {
              <div class="error">
                El nom és obligatori (mínim 2 caràcters).
              </div>
            }
          </div>
        } @else if (selectedRole === 2) {
          <div class="input-group">
            <label for="actividad" class="form-label">Activitat</label>
            <div class="input-control">
              <input
                type="text"
                id="actividad"
                [(ngModel)]="actividad"
                name="actividad"
                placeholder="Introdueix l'activitat"
                required
                minlength="2"
                #actividadModel="ngModel"
              />
            </div>
            @if (actividadModel.invalid && (actividadModel.touched || actividadModel.dirty)) {
              <div class="error">
                L'activitat és obligatòria (mínim 2 caràcters).
              </div>
            }
          </div>
        }

        <div class="input-group">
          <label for="direccion" class="form-label">Adreça</label>
          <div class="input-control">
            <input
              type="text"
              id="direccion"
              [(ngModel)]="direccion"
              name="direccion"
              placeholder="Introdueix l'adreça"
              required
              minlength="2"
              #direccionModel="ngModel"
            />
          </div>
          @if (direccionModel.invalid && (direccionModel.touched || direccionModel.dirty)) {
            <div class="error">
              L'adreça és obligatòria (mínim 2 caràcters).
            </div>
          }
        </div>

        <div class="input-group">
          <label for="email" class="form-label">Correu electrònic</label>
          <div class="input-control">
            <input
              type="email"
              id="email"
              [(ngModel)]="email"
              name="email"
              placeholder="Introdueix el correu"
              required
              email
              #emailModel="ngModel"
            />
          </div>
          @if (emailModel.invalid && (emailModel.touched || emailModel.dirty)) {
            <div class="error">
              El correu és obligatori i ha de ser vàlid.
            </div>
          }
        </div>

        <div class="input-group">
          <label for="telefono" class="form-label">Telèfon</label>
          <div class="input-control">
            <input
              type="text"
              id="telefono"
              [(ngModel)]="telefono"
              name="telefono"
              placeholder="Introdueix el telèfon"
              required
              pattern="[0-9]{9}"
              #telefonoModel="ngModel"
            />
          </div>
          @if (telefonoModel.invalid && (telefonoModel.touched || telefonoModel.dirty)) {
            <div class="error">
              El telèfon és obligatori (9 dígits).
            </div>
          }
        </div>

        <input
          type="hidden"
          [(ngModel)]="associatedDni"
          name="associatedDni"
        />

        <button type="submit" class="auth-btn" [disabled]="empresaForm.invalid">
          Enviar
        </button>

        @if (formError) {
          <div class="error">
            {{ formError }}
          </div>
        }
      </form>
    }
  </div>
</div>
